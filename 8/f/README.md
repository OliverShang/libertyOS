# 修复`fork()`
`fork()`的BUG来自进程地址空间的问题，包括以下三点：

- 为子进程分配虚拟内存时，需要切换到子进程的地址空间. 为此新增了`vm_alloc_ex()`函数;
- 拷贝父进程的数据段时，需要拷贝到子进程的地址空间. 为此新增了系统调用`write_process_memory()`;
- IPC模块，拷贝消息结构体时，不仅需要用`va2la()`得到线性地址，而且同样需要使用`write_process_memory()`.